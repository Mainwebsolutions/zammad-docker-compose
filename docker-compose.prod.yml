zammad-backup:
  command: ["zammad-backup"]
  entrypoint: /usr/local/bin/backup.sh
  image: ${IMAGE_REPO}:zammad-postgresql${VERSION}
  links:
    - zammad-postgresql
  restart: always
  volumes:
    - /storage-zammad/zammad/zammad-backup:/var/tmp/zammad
    - /storage-zammad/zammad/zammad-data:/opt/zammad

zammad-elasticsearch:
  image: ${IMAGE_REPO}:zammad-elasticsearch${VERSION}
  restart: always
  volumes:
    - /storage-zammad/zammad/elasticsearch-data:/usr/share/elasticsearch/data

zammad-init:
  command: ["zammad-init"]
  image: ${IMAGE_REPO}:zammad${VERSION}
  links:
    - zammad-elasticsearch
    - zammad-postgresql
  restart: on-failure
  volumes:
    - /storage-zammad/zammad/zammad-data:/opt/zammad

zammad-memcached:
  command: ["zammad-memcached"]
  image: ${IMAGE_REPO}:zammad-memcached${VERSION}
  restart: always

zammad-nginx:
  command: ["zammad-nginx"]
  image: ${IMAGE_REPO}:zammad${VERSION}
  links:
    - zammad-railsserver
    - zammad-websocket
  restart: always
  volumes:
    - /storage-zammad/zammad/zammad-data:/opt/zammad
  expose:
    - "80"

zammad-postgresql:
  image: ${IMAGE_REPO}:zammad-postgresql${VERSION}
  restart: always
  volumes:
    - /storage-zammad/zammad/postgresql-data:/var/lib/postgresql/data

zammad-railsserver:
  command: ["zammad-railsserver"]
  image: ${IMAGE_REPO}:zammad${VERSION}
  links:
    - zammad-elasticsearch
    - zammad-memcached
    - zammad-postgresql
  restart: always
  volumes:
    - /storage-zammad/zammad/zammad-data:/opt/zammad

zammad-scheduler:
  command: ["zammad-scheduler"]
  image: ${IMAGE_REPO}:zammad${VERSION}
  links:
    - zammad-elasticsearch
    - zammad-memcached
    - zammad-postgresql
  restart: always
  volumes:
    - /storage-zammad/zammad/zammad-data:/opt/zammad

zammad-websocket:
  command: ["zammad-websocket"]
  image: ${IMAGE_REPO}:zammad${VERSION}
  links:
    - zammad-postgresql
    - zammad-memcached
  restart: always
  volumes:
    - /storage-zammad/zammad/zammad-data:/opt/zammad